import{c as z,d as m,r as S,o as a,a as i,b as g,e as u,M as B,s as E,f as h,w as N,v as R,t as C,F as k,g as q,h as j,n as L,i as v,j as M,k as O}from"./vendor.js";const A=function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function t(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerpolicy&&(o.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?o.credentials="include":n.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(n){if(n.ep)return;n.ep=!0;const o=t(n);fetch(n.href,o)}};A();const K="https://jexpcababkrsoibblglb.supabase.co",F="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpleHBjYWJhYmtyc29pYmJsZ2xiIiwicm9sZSI6ImFub24iLCJpYXQiOjE2NDY3MDk1OTQsImV4cCI6MTk2MjI4NTU5NH0.F2MU8sqYQiQD2mF-jpm_jNoFssItWKTtWcRzrMPJgzc",J=z(K,F);var d=(e,s)=>{const t=e.__vccOpts||e;for(const[r,n]of s)t[r]=n;return t};const H=m({components:{SearchIcon:S}}),Y={class:"fixed right-10 bottom-10 bg-gray-800 rounded-full p-2 drop-shadow-lg cursor-pointer border border-gray-100 border-2"};function P(e,s,t,r,n,o){const c=u("SearchIcon");return a(),i("div",Y,[g(c,{class:"h-6 w-6 text-gray-100"})])}var U=d(H,[["render",P]]);function W(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}const Z=.9;async function Q(e){const s=new B({idField:"url",fields:["title","desc","text"],storeFields:["url","title","desc","text","catched_at"],searchOptions:{boost:{title:100}}});return s.addAll(e.map(t=>({url:t.url,title:t.title,desc:t.desc,text:t.text,catched_at:t.catched_at}))),s}function x(e,s,t=-1,r=-1,n="<b>",o="</b>"){const c=E(e,[s],{returnMatchData:!0,threshold:Z});if(!c.length)return{highlight:s,matchLength:0};const l=c[0].match.index,y=c[0].match.index+c[0].match.length,_=s.slice(l,y),V=new RegExp(`((.|
)*)(s|^|[^(A-Z|a-z|')])(.*?${W(_)})((.|
)*)`,"gi");function D(Ve,$,De,w,I,b){if(t<0&&r<0)return $+w+n+I+o+b;{let p=$,f=b;return t>0?p=$.split(/\s/).slice(-t).join(" "):t===0&&(p=""),r>0?f=b.split(/\s/).slice(0,r).join(" "):r===0&&(f=""),p.length<$.length&&(p="\u2026"+p),f.length<b.length&&(f=f+"\u2026"),p+w+n+I+o+f}}return{highlight:s.replace(V,D),matchLength:_.length}}const G=m({props:{modelValue:{type:String,default:""}},components:{SearchIcon:S},data(){return{}},computed:{inputValue:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},ctrlKey(){let e="";return navigator.platform?e=navigator.platform.toLowerCase():navigator.userAgentData&&(e=navigator.userAgentData.platform.toLowerCase()),e.includes("mac")||e.includes("iphone")||e.includes("ipad")?"\u2318":"Ctrl"}},methods:{focus(){this.$refs.input.focus()},unfocus(){this.$refs.input.blur()}}}),T={class:"relative flex gap-4 p-4"},X={class:"flex items-center pointer-events-none"},ee={class:"absolute inset-y-0 right-0 text-xs text-gray-300 lg:flex justify-center items-center mr-4"},te={class:"inline border border-1 rounded flex justify-center items-center h-6 px-1"};function se(e,s,t,r,n,o){const c=u("SearchIcon");return a(),i("div",T,[h("div",X,[g(c,{class:"h-7 w-7 text-gray-400","aria-hidden":"true"})]),N(h("input",{ref:"input","onUpdate:modelValue":s[0]||(s[0]=l=>e.inputValue=l),type:"text",name:"query",class:"focus:ring-0 focus:border-white focus-visible:outline-none p-0 w-full z-10 bg-transparent"},null,512),[[R,e.inputValue]]),h("div",ee,[h("div",te,C(e.ctrlKey)+" + K",1)])])}var ne=d(G,[["render",se]]);const re=m({props:{results:{type:Array,default:[]}}}),oe={class:"text-gray-700 flex flex-col divide-y"},ce=["href"],ae={class:"font-semibold text-lg truncate"},ie=["innerHTML"],le={key:0},he={key:1,class:"px-5 py-4"};function ue(e,s,t,r,n,o){return a(),i("div",oe,[(a(!0),i(k,null,q(e.results,(c,l)=>(a(),i("a",{key:l,class:"px-5 py-4 hover:bg-gray-50 cursor-pointer flex flex-col gap-1",href:c.url},[h("h1",ae,C(c.title),1),h("p",{class:"truncate",innerHTML:c.text},null,8,ie)],8,ce))),128)),e.results.length?(a(),i("div",le)):(a(),i("div",he," No results "))])}var de=d(re,[["render",ue]]);const pe={},fe={class:"text-gray-300 flex gap-1 justify-end px-3 py-2 text-xs font-semibold"},me=h("span",null,[j("Powered by "),h("a",{class:"text-gray-400",href:"https://try.catche.co"},"Catche")],-1),ge=[me];function ye(e,s){return a(),i("div",fe,ge)}var _e=d(pe,[["render",ye]]);const $e=m({async mounted(){this.searcher=await Q(this.data)},props:{show:{type:Boolean,default:!1},data:{type:Array,default:[]}},components:{SearchBox:ne,Results:de,Branding:_e},watch:{query(e,s){e?(this.open=!0,this.search()):this.open=!1},show(e,s){e?this.$refs.searchBox.focus():this.$refs.searchBox.unfocus()}},data(){return{open:!1,query:"",searcher:null,numResults:10,results:[]}},methods:{search(){const e=this.searcher.search(this.query,{prefix:t=>t.length<=3,fuzzy:t=>t.length>3?.1:null,combineWith:"AND"}).sort((t,r)=>{const n=r.score-t.score;return Math.abs(n)>5?n:r.catched_at-t.catched_at});let s=[];e.length<this.numResults&&(s=this.searcher.search(this.query,{prefix:t=>t.length<=3,fuzzy:t=>t.length>3?.3:null,combineWith:"OR"}).sort((t,r)=>{const n=r.score-t.score;return Math.abs(n)>5?n:r.catched_at-t.catched_at}).filter(t=>!e.map(r=>r.url).includes(t.url))),this.results=e.concat(s).slice(0,this.numResults).map((t,r)=>{const n=x(this.query,t.desc,2,10),o=x(this.query,t.text,2,10),c=n.matchLength>=o.matchLength?n.highlight:o.highlight;return{url:t.url,title:t.title,highlightedTitle:x(this.query,t.title).highlight,desc:t.desc,text:c,catched_at:t.catched_at}})}}});function be(e,s,t,r,n,o){const c=u("SearchBox"),l=u("Results"),y=u("Branding");return a(),i("div",{class:L(["font-sans fixed w-128 max-w-full bg-white shadow-catche top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 rounded-3xl flex flex-col divide-y overflow-hidden",[e.show?"opacity-100":"opacity-0 pointer-events-none",e.open?"h-96":"h-[3.75rem]"]]),style:{transition:"opacity 300ms, height 300ms"}},[g(c,{modelValue:e.query,"onUpdate:modelValue":s[0]||(s[0]=_=>e.query=_),ref:"searchBox"},null,8,["modelValue"]),g(l,{class:"h-96 overflow-y-scroll",results:e.results},null,8,["results"]),g(y)],2)}var xe=d($e,[["render",be]]);const ve=m({mounted(){const e=document.querySelector("script[catche-key]");e&&(this.catcheKey=e.getAttribute("catche-key")),this.loadData().then(s=>this.data=s).then(()=>{document.addEventListener("keydown",s=>{const t=s.key;(s.ctrlKey||s.metaKey)&&t==="k"&&(s.preventDefault(),this.show=!this.show)},!1)})},components:{Icon:U,SearchMenu:xe},data(){return{catcheKey:"f740a6a5-c248-49a0-8bc8-a3855441f016",show:!1,searcher:null,data:[],prevBodyCss:{}}},watch:{},methods:{toggle(){this.show=!this.show},async loadData(){let{data:e,error:s}=await J.from("webpages_free").select().eq("catche_key",this.catcheKey);return s?(console.log(s),[]):e}}});function we(e,s,t,r,n,o){const c=u("Icon"),l=u("SearchMenu");return a(),i(k,null,[e.data.length?(a(),v(c,{key:0,onClick:e.toggle,style:{"z-index":"2147483645"}},null,8,["onClick"])):M("",!0),h("div",{class:L(["fixed top-0 left-0 bg-white h-screen w-screen transition-all duration-300",e.show?"opacity-80":"opacity-0 pointer-events-none"]),onClick:s[0]||(s[0]=y=>e.show=!1),style:{"z-index":"2147483646"}},null,2),e.data.length?(a(),v(l,{key:1,show:e.show,data:e.data,style:{"z-index":"2147483647"}},null,8,["show","data"])):M("",!0)],64)}var Ie=d(ve,[["render",we]]);const Me=m({components:{Main:Ie}});function Se(e,s,t,r,n,o){const c=u("Main");return a(),v(c)}var Ce=d(Me,[["render",Se]]);function ke(){var o;const e=document.getElementById("catche-search");e&&document.body.removeChild(e);const s=document.createElement("div");s.setAttribute("id","catche-search");const t=document.createElement("div"),r=document.createElement("link"),n=((o=s.attachShadow)==null?void 0:o.call(s,{mode:"closed"}))||s;r.setAttribute("rel","stylesheet"),r.setAttribute("href","https://cdn.jsdelivr.net/gh/greentfrapp/probable-robot@0.0.4/index.css"),n.appendChild(r),n.appendChild(t),O(Ce).mount(t),document.body.appendChild(s)}ke();
