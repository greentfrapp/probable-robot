import{c as E,d as m,r as C,o as l,a as c,b as g,e as d,M as N,s as V,f as u,w as T,v as R,t as q,F as S,g as z,n as v,h as A,i as w,j as M,k as B}from"./vendor.js";const j=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function s(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerpolicy&&(o.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?o.credentials="include":r.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=s(r);fetch(r.href,o)}};j();const O="https://jexpcababkrsoibblglb.supabase.co",H="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpleHBjYWJhYmtyc29pYmJsZ2xiIiwicm9sZSI6ImFub24iLCJpYXQiOjE2NDY3MDk1OTQsImV4cCI6MTk2MjI4NTU5NH0.F2MU8sqYQiQD2mF-jpm_jNoFssItWKTtWcRzrMPJgzc",K=E(O,H);var h=(e,t)=>{const s=e.__vccOpts||e;for(const[n,r]of t)s[n]=r;return s};const F=m({components:{SearchIcon:C}}),J={class:"fixed right-10 bottom-10 bg-gray-800 rounded-full p-2 drop-shadow-lg cursor-pointer border border-gray-100 border-2"};function U(e,t,s,n,r,o){const i=d("SearchIcon");return l(),c("div",J,[g(i,{class:"h-6 w-6 text-gray-100"})])}var Y=h(F,[["render",U]]);function P(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}const W=.9;async function Z(e){const t=new N({idField:"url",fields:["title","text"],storeFields:["url","title","text"],searchOptions:{boost:{title:100}}});return t.addAll(e.map(s=>({id:s.id,url:s.url,title:s.title,text:s.text}))),t}function k(e,t,s=-1,n=-1,r="<b>",o="</b>"){const i=V(e,[t],{returnMatchData:!0,threshold:W});if(!i.length)return{highlight:t,matchLength:0};const a=i[0].match.index,y=i[0].match.index+i[0].match.length,_=t.slice(a,y),D=new RegExp(`((.|
)*)(s|^|[^(A-Z|a-z|')])(.*?${P(_)})((.|
)*)`,"gi");function L(De,b,Le,x,I,$){if(s<0&&n<0)return b+x+r+I+o+$;{let p=b,f=$;return s>0?p=b.split(/\s/).slice(-s).join(" "):s===0&&(p=""),n>0?f=$.split(/\s/).slice(0,n).join(" "):n===0&&(f=""),p.length<b.length&&(p="\u2026"+p),f.length<$.length&&(f=f+"\u2026"),p+x+r+I+o+f}}return{highlight:t.replace(D,L),matchLength:_.length}}const G=m({props:{modelValue:{type:String,default:""}},components:{SearchIcon:C},data(){return{}},computed:{inputValue:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},ctrlKey(){let e="";return navigator.platform?e=navigator.platform.toLowerCase():navigator.userAgentData&&(e=navigator.userAgentData.platform.toLowerCase()),e.includes("mac")||e.includes("iphone")||e.includes("ipad")?"\u2318":"Ctrl"}},methods:{focus(){this.$refs.input.focus()},unfocus(){this.$refs.input.blur()}}}),Q={class:"relative flex gap-4 p-4"},X={class:"flex items-center pointer-events-none"},ee={class:"hidden sm:flex absolute inset-y-0 right-4 text-xs text-gray-300 justify-center items-center"},te={class:"border rounded flex justify-center items-center py-0.5 px-1"};function se(e,t,s,n,r,o){const i=d("SearchIcon");return l(),c("div",Q,[u("div",X,[g(i,{class:"h-7 w-7 text-gray-400","aria-hidden":"true"})]),T(u("input",{ref:"input","onUpdate:modelValue":t[0]||(t[0]=a=>e.inputValue=a),type:"text",class:"focus:ring-0 focus:border-0 focus-visible:outline-none p-0 w-full bg-transparent border-0"},null,512),[[R,e.inputValue]]),u("div",ee,[u("div",te,q(e.ctrlKey)+" + K",1)])])}var ne=h(G,[["render",se]]);const re=m({emits:["close"],props:{results:{type:Array,default:[]},selected:{type:Number,default:0}},watch:{selected(e,t){var s;e!==-1&&e!==t&&((s=document.getElementById(`result-${e}`))==null||s.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"}))}}}),oe={class:"text-gray-700 flex flex-col divide-y"},ie=["id","href"],le=["innerHTML"],ae=["innerHTML"],ce={key:0},ue={key:1,class:"px-5 py-4"};function de(e,t,s,n,r,o){return l(),c("div",oe,[(l(!0),c(S,null,z(e.results,(i,a)=>(l(),c("a",{key:a,id:`result-${a}`,class:v(["px-5 py-4 hover:bg-gray-100 cursor-pointer flex flex-col gap-1",e.selected===a?"bg-gray-100":""]),href:i.url,onClick:t[0]||(t[0]=y=>e.$emit("close"))},[u("h1",{class:"text-xl truncate",innerHTML:i.title},null,8,le),u("p",{class:"truncate",innerHTML:i.text},null,8,ae)],10,ie))),128)),e.results.length?(l(),c("div",ce)):(l(),c("div",ue," No results "))])}var he=h(re,[["render",de]]);const pe={},fe={class:"text-gray-300 flex gap-1 justify-end px-3 py-2 text-xs font-bold"},me=u("span",null,[A("Powered by "),u("a",{class:"text-gray-400",href:"https://try.catche.co"},"Catche")],-1),ye=[me];function ge(e,t){return l(),c("div",fe,ye)}var _e=h(pe,[["render",ge]]);const be=m({async mounted(){this.searcher=await Z(this.data),document.addEventListener("keydown",e=>{const t=e.key;if(t==="ArrowUp")e.preventDefault(),this.selected=Math.max(0,this.selected-1);else if(t==="ArrowDown")e.preventDefault(),this.selected=Math.min(Math.max(this.results.length-1,0),this.selected+1);else if(t==="Enter"){e.preventDefault();const s=this.results[this.selected].url;this.query="",this.selected=-1,this.open=!1,this.$emit("close"),setTimeout(()=>window.location.href=s,10)}},!1)},props:{show:{type:Boolean,default:!1},data:{type:Array,default:[]}},components:{SearchBox:ne,Results:he,Branding:_e},watch:{query(e){this.selected=e?0:-1,this.debounceTimerId&&clearTimeout(this.debounceTimerId),e?(this.open=!0,this.debounceTimerId=setTimeout(()=>{this.search()},this.debounceTimeout)):this.open=!1},show(e){e?this.$refs.searchBox.focus():this.$refs.searchBox.unfocus()}},data(){return{open:!1,query:"",searcher:null,numResults:10,results:[],selected:0,debounceTimerId:null,debounceTimeout:50}},methods:{search(){const e=performance.now(),t=this.searcher.search(this.query,{prefix:n=>n.length<=3,fuzzy:n=>n.length>3?.1:!1,combineWith:"AND"});let s=[];t.length<this.numResults&&(s=this.searcher.search(this.query,{prefix:n=>n.length<=3,fuzzy:n=>n.length>3?.3:!1,combineWith:"OR"}).filter(n=>!t.map(r=>r.url).includes(n.url))),this.results=t.concat(s).slice(0,this.numResults).map(n=>({url:n.url||"",title:k(this.query,n.title).highlight||"",text:k(this.query,n.text,3,10).highlight||""})),this.updateDebounce(performance.now()-e)},close(){this.open=!1,this.query="",this.$emit("close")},updateDebounce(e){this.debounceTimeout=.9*this.debounceTimeout+.1*e}}});function $e(e,t,s,n,r,o){const i=d("SearchBox"),a=d("Results"),y=d("Branding");return l(),c("div",{class:v(["font-sans w-full sm:w-128 max-w-full bg-white shadow-catche fixed top-0 sm:top-1/2 left-1/2 -translate-x-1/2 sm:-translate-y-1/2 sm:rounded-3xl flex flex-col divide-y overflow-hidden",[e.show?"opacity-100":"opacity-0 pointer-events-none",e.open?"h-96":"h-[3.75rem]"]]),style:{transition:"opacity 300ms, height 300ms"}},[g(i,{modelValue:e.query,"onUpdate:modelValue":t[0]||(t[0]=_=>e.query=_),ref:"searchBox"},null,8,["modelValue"]),g(a,{class:"h-96 overflow-y-scroll",results:e.results,onClose:e.close,selected:e.selected},null,8,["results","onClose","selected"]),g(y)],2)}var we=h(be,[["render",$e]]);const ve=m({mounted(){const e=document.querySelector("script[catche-key]");e&&(this.catcheKey=e.getAttribute("catche-key")),this.loadData().then(t=>this.data=t).then(()=>{document.addEventListener("keydown",t=>{const s=t.key;(t.ctrlKey||t.metaKey)&&s==="k"&&(t.preventDefault(),this.show=!this.show)},!1)})},components:{Icon:Y,SearchMenu:we},data(){return{catcheKey:"00000000-0000-0000-0000-000000000000",show:!1,searcher:null,data:[]}},methods:{toggle(){this.show=!this.show},async loadData(){let{data:e,error:t}=await K.from("webpages_free").select().eq("catche_key",this.catcheKey);return t?(console.error(t),[]):e}}});function xe(e,t,s,n,r,o){const i=d("Icon"),a=d("SearchMenu");return l(),c(S,null,[e.data.length?(l(),w(i,{key:0,onClick:e.toggle,style:{"z-index":"2147483645"}},null,8,["onClick"])):M("",!0),u("div",{class:v(["fixed top-0 left-0 bg-white h-screen w-screen transition-all duration-300",e.show?"opacity-80":"opacity-0 pointer-events-none"]),onClick:t[0]||(t[0]=y=>e.show=!1),style:{"z-index":"2147483646"}},null,2),e.data.length?(l(),w(a,{key:1,show:e.show,data:e.data,style:{"z-index":"2147483647"}},null,8,["show","data"])):M("",!0)],64)}var Ie=h(ve,[["render",xe]]);const Me=m({components:{Main:Ie}});function ke(e,t,s,n,r,o){const i=d("Main");return l(),w(i)}var Ce=h(Me,[["render",ke]]);(function(){var o;const t=document.createElement("div");t.setAttribute("id","catche-search");const s=document.createElement("div"),n=document.createElement("link"),r=((o=t.attachShadow)==null?void 0:o.call(t,{mode:"closed"}))||t;n.setAttribute("rel","stylesheet"),n.setAttribute("href","https://cdn.jsdelivr.net/gh/greentfrapp/probable-robot@0.0.7/index.css"),r.appendChild(n),r.appendChild(s),B(Ce).mount(s),document.body.appendChild(t)})();
