import{c as V,d as p,r as w,o as a,a as i,b as m,e as h,M as D,s as L,f as d,w as A,v as E,t as M,F as k,g as N,h as R,n as S,i as v,j as B,k as z}from"./vendor.js";const j=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function s(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerpolicy&&(r.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?r.credentials="include":o.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(o){if(o.ep)return;o.ep=!0;const r=s(o);fetch(o.href,r)}};j();const q="https://jexpcababkrsoibblglb.supabase.co",K="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpleHBjYWJhYmtyc29pYmJsZ2xiIiwicm9sZSI6ImFub24iLCJpYXQiOjE2NDY3MDk1OTQsImV4cCI6MTk2MjI4NTU5NH0.F2MU8sqYQiQD2mF-jpm_jNoFssItWKTtWcRzrMPJgzc",F=V(q,K);var u=(e,t)=>{const s=e.__vccOpts||e;for(const[n,o]of t)s[n]=o;return s};const J=p({components:{SearchIcon:w}}),Y={class:"fixed right-10 bottom-10 bg-gray-800 rounded-full p-2 drop-shadow-lg cursor-pointer border border-gray-100 border-2"};function H(e,t,s,n,o,r){const c=h("SearchIcon");return a(),i("div",Y,[m(c,{class:"h-6 w-6 text-gray-100"})])}var T=u(J,[["render",H]]);function P(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}const U=.9;async function X(e){const t=new D({idField:"url",fields:["title","desc","text"],storeFields:["url","title","desc","text","catched_at"],searchOptions:{boost:{title:100}}});return t.addAll(e.map(s=>({url:s.url,title:s.title,desc:s.desc,text:s.text,catched_at:s.catched_at}))),t}function C(e,t,s=-1,n="<b>",o="</b>"){const r=L(e,[t],{returnMatchData:!0,threshold:U});if(!r.length)return{highlight:t,matchLength:0};const c=r[0].match.index,l=r[0].match.index+r[0].match.length,f=t.slice(c,l),_=new RegExp(`((.|
)*)(s|^|[^(A-Z|a-z|')])(.*?${P(f)})((.|
)*)`,"gi");function O(Se,b,Oe,x,I,$){if(s<0)return b+x+n+I+o+$;{let y=b.split(/\s/).slice(-Math.ceil(s/2)).join(" ");y.length<b.length&&(y="\u2026"+y);let g=$.split(/\s/).slice(0,Math.ceil(s/2)).join(" ");return g.length<$.length&&(g=g+"\u2026"),y+x+n+I+o+g}}return{highlight:t.replace(_,O),matchLength:f.length}}const W=p({props:{modelValue:{type:String,default:""}},components:{SearchIcon:w},data(){return{}},computed:{inputValue:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},ctrlKey(){let e="";return navigator.platform?e=navigator.platform.toLowerCase():navigator.userAgentData&&(e=navigator.userAgentData.platform.toLowerCase()),e.includes("mac")||e.includes("iphone")||e.includes("ipad")?"\u2318":"Ctrl"}},methods:{focus(){this.$refs.input.focus()},unfocus(){this.$refs.input.blur()}}}),Z={class:"relative flex gap-4 p-4"},Q={class:"flex items-center pointer-events-none"},G={class:"absolute inset-y-0 right-0 text-xs text-gray-300 lg:flex justify-center items-center mr-4"},ee={class:"inline border border-1 rounded flex justify-center items-center h-6 px-1"};function te(e,t,s,n,o,r){const c=h("SearchIcon");return a(),i("div",Z,[d("div",Q,[m(c,{class:"h-7 w-7 text-gray-400","aria-hidden":"true"})]),A(d("input",{ref:"input","onUpdate:modelValue":t[0]||(t[0]=l=>e.inputValue=l),type:"text",name:"query",class:"focus:ring-0 focus:border-white focus-visible:outline-none p-0 w-full z-10 bg-transparent"},null,512),[[E,e.inputValue]]),d("div",G,[d("div",ee,M(e.ctrlKey)+" + K",1)])])}var se=u(W,[["render",te]]);const oe=p({props:{results:{type:Array,default:[]}},components:{SearchIcon:w}}),ne={class:"text-gray-700 flex flex-col divide-y"},re=["href"],ce={class:"font-semibold"},ae=["innerHTML"],ie={key:0},le={key:1,class:"px-5 py-4"};function de(e,t,s,n,o,r){return a(),i("div",ne,[(a(!0),i(k,null,N(e.results,(c,l)=>(a(),i("a",{key:l,class:"px-5 py-4 hover:bg-gray-50 cursor-pointer",href:c.url},[d("h1",ce,M(c.title),1),d("p",{class:"truncate",innerHTML:c.text},null,8,ae)],8,re))),128)),e.results.length?(a(),i("div",ie)):(a(),i("div",le," No results "))])}var he=u(oe,[["render",de]]);const ue={},pe={class:"text-gray-300 flex gap-1 justify-end px-3 py-2 text-xs font-semibold"},fe=d("span",null,[R("Powered by "),d("a",{class:"text-gray-400",href:"https://try.catche.co"},"Catche")],-1),me=[fe];function ye(e,t){return a(),i("div",pe,me)}var ge=u(ue,[["render",ye]]);const _e=p({async mounted(){this.searcher=await X(this.data)},props:{show:{type:Boolean,default:!1},data:{type:Array,default:[]}},components:{SearchBox:se,Results:he,Branding:ge},watch:{query(e,t){e?(this.open=!0,this.search()):this.open=!1},show(e,t){e?this.$refs.searchBox.focus():this.$refs.searchBox.unfocus()}},data(){return{open:!1,query:"",searcher:null,numResults:10,results:[]}},methods:{search(){const e=this.searcher.search(this.query,{prefix:s=>s.length<=3,fuzzy:s=>s.length>3?.1:null,combineWith:"AND"}).sort((s,n)=>{const o=n.score-s.score;return Math.abs(o)>5?o:n.catched_at-s.catched_at});let t=[];e.length<this.numResults&&(t=this.searcher.search(this.query,{prefix:s=>s.length<=3,fuzzy:s=>s.length>3?.3:null,combineWith:"OR"}).sort((s,n)=>{const o=n.score-s.score;return Math.abs(o)>5?o:n.catched_at-s.catched_at}).filter(s=>!e.map(n=>n.url).includes(s.url))),this.results=e.concat(t).slice(0,this.numResults).map((s,n)=>({url:s.url,title:s.title,highlightedTitle:C(this.query,s.title).highlight,desc:s.desc,text:C(this.query,s.text,5).highlight,catched_at:s.catched_at}))}}});function be(e,t,s,n,o,r){const c=h("SearchBox"),l=h("Results"),f=h("Branding");return a(),i("div",{class:S(["font-sans fixed w-128 max-w-full bg-white shadow-catche top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 rounded-3xl flex flex-col divide-y overflow-hidden",[e.show?"opacity-100":"opacity-0 pointer-events-none",e.open?"h-96":"h-[3.75rem]"]]),style:{transition:"opacity 300ms, height 300ms"}},[m(c,{modelValue:e.query,"onUpdate:modelValue":t[0]||(t[0]=_=>e.query=_),ref:"searchBox"},null,8,["modelValue"]),m(l,{class:"h-96 overflow-y-scroll",results:e.results},null,8,["results"]),m(f)],2)}var $e=u(_e,[["render",be]]);const ve=p({mounted(){const e=document.querySelector("script[catche-key]");e&&(this.catcheKey=e.getAttribute("catche-key")),this.loadData().then(t=>this.data=t).then(()=>{document.addEventListener("keydown",t=>{const s=t.key;(t.ctrlKey||t.metaKey)&&s==="k"&&(t.preventDefault(),this.show=!this.show)},!1)})},components:{Icon:T,SearchMenu:$e},data(){return{catcheKey:"f740a6a5-c248-49a0-8bc8-a3855441f016",show:!1,searcher:null,data:[],prevBodyCss:{}}},watch:{show(e){e?this.freezeBody():this.meltBody()}},methods:{toggle(){this.show=!this.show},async loadData(){let{data:e,error:t}=await F.from("webpages_free").select().eq("catche_key",this.catcheKey);return t?(console.log(t),[]):e},freezeBody(){const e={position:document.body.style.position,left:document.body.style.left,top:document.body.style.top};this.prevBodyCss=e;const t=window.pageXOffset,s=window.pageYOffset;document.body.style.position="fixed",document.body.style.left=`-${t}px`,document.body.style.top=`-${s}px`},meltBody(){const e=document.body.style.left,t=document.body.style.top;document.body.style.position=this.prevBodyCss.position,document.body.style.left=this.prevBodyCss.left,document.body.style.top=this.prevBodyCss.top,window.scrollTo(parseInt(e||"0")*-1,parseInt(t||"0")*-1)}}});function we(e,t,s,n,o,r){const c=h("Icon"),l=h("SearchMenu");return a(),i(k,null,[e.data.length?(a(),v(c,{key:0,onClick:e.toggle},null,8,["onClick"])):B("",!0),d("div",{class:S(["fixed top-0 left-0 bg-white h-screen w-screen transition-all duration-300",e.show?"opacity-80":"opacity-0 pointer-events-none"]),onClick:t[0]||(t[0]=f=>e.show=!1)},null,2),e.data.length?(a(),v(l,{key:1,show:e.show,data:e.data},null,8,["show","data"])):B("",!0)],64)}var xe=u(ve,[["render",we]]);const Ie=p({components:{Main:xe}});function Be(e,t,s,n,o,r){const c=h("Main");return a(),v(c)}var Ce=u(Ie,[["render",Be]]);function Me(){var r;const e=document.getElementById("catche-search");e&&document.body.removeChild(e);const t=document.createElement("div");t.setAttribute("id","catche-search");const s=document.createElement("div"),n=document.createElement("link"),o=((r=t.attachShadow)==null?void 0:r.call(t,{mode:"closed"}))||t;n.setAttribute("rel","stylesheet"),n.setAttribute("href","https://cdn.jsdelivr.net/gh/greentfrapp/probable-robot@v0.0.1/index.css"),o.appendChild(n),o.appendChild(s),z(Ce).mount(s),document.body.appendChild(t)}Me();
